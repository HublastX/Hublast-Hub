services:
    db:
        image: postgres:17
        restart: always
        ports:
            - "5452:5432"
        environment:
            POSTGRES_USER: ${POSTGRES_USER}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            POSTGRES_DB: ${POSTGRES_DB}
        volumes:
            - db_data:/var/lib/postgresql/data
        networks:
            - project_network

    hublast_hub_backend:
        build:
            context: ./backend
            dockerfile: Dockerfile
        restart: always
        ports:
            - "5000:5000"
        environment:
            POSTGRES_USER: ${POSTGRES_USER}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            POSTGRES_DB: ${POSTGRES_DB}
            DB_HOST: db
            DB_PORT: 5432
        depends_on:
            - db
        networks:
            - project_network

    hublast_hub_frontend:
        build:
            context: ./frontend/hublast
            dockerfile: Dockerfile
        restart: always
        ports:
            - "3000:3000"
        environment:
            POSTGRES_USER: ${POSTGRES_USER}
            POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
            POSTGRES_DB: ${POSTGRES_DB}
            DB_HOST: db
            DB_PORT: 5432
        depends_on:
            - db
        networks:
            - project_network

volumes:
    db_data:


networks:
  project_network:
    external: true
